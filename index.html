<!DOCTYPE html>
<!--[if lt IE 7]> <html class="lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]> <html class="lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]> <html class="lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html lang="en"> <!--<![endif]-->
<head>
		<title>Teachout/Wu 2014</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <!--[if lt IE 9]><script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
    <link rel="stylesheet" href="css/style.css">
		<script type="text/javascript" src="js/libs/jquery/jquery.js"></script>
		<script type="text/javascript">

			////////////////////////////////////////////////
			//
			//	this code contributed to the
			//	Teachout/Wu 2014 New York Gubernatorial Campaign
			//	by David F. Nevin http://dnevin.com
			//
			////////////////////////////////////////////////

			window.onkeydown=function() {
				var key;
				if (window.event) key=event.keyCode;
				else if (event.which) key=event.which;
				//if (key==0x0d) document.getElementById("btnYes").click();
			};
			/*
			function handleClientLoad() {
				window.setTimeout(checkAuth, 1);
			}
			*/
			function search() {
				checkAuth();
			}
			function checkAuth() {
				gapi.client.setApiKey("AIzaSyAT1NSVHh3u_wOT2rKu5JSCJExMhR8RsdI");
				var Request=gapi.client.request({
					"path": "/civicinfo/v1/voterinfo/4047/lookup",
					"method": "POST",
					"body": {"address": document.getElementById("inputaddress").value}
				});
				Request.execute(GetResponse);
			}
			function GetResponse(resp,rawResp) {
				// clear any old fields
				document.getElementById("PollingPlace").style.display="none";
				document.getElementById("ppName").innerText="";
				document.getElementById("ppLine1").innerText="";
				document.getElementById("ppLine2").innerText="";
				var q2=document.getElementById("q2");
				var em=document.getElementById("errorMessage");
				em.innerHTML="";
				if (!resp || resp.error) {
					var em = q2.appendChild(document.createElement("tt"));
					em.innerHTML="<br>An error occurred while trying to fetch the polling place information<br>" + JSON.stringify(resp);
					return;
				}

				console.log( JSON.stringify(resp));

				if (resp.normalizedInput) {
					with (resp.normalizedInput) {
						document.getElementById("inputaddress").value=line1 + ", " + city + ", " + state + ", " + zip;
					}
				}

				if (resp.status!="success") {
					em.style.display="block";
					switch (resp.status) {
						case "noAddressParameter":
							em.innerHTML="<br/>no address was entered";
							break;
						case "noStreetSegmentFound":
							em.innerHTML="<br/>no voter is registered at that address";
							break;
						case "addressUnparseable":
							em.innerHTML="<br/>could not understand this address - please try again";
							break;
						default:
							em.innerHTML="<br/>An error occurred while trying to fetch the polling place information<br/>" + JSON.stringify(resp);
					};
					return;
				};

				document.getElementById("errorMessage").style.display="none";


				var pp=document.getElementById("PollingPlace");
				pp.style.display="inline";

				//var ins = pp.appendChild(document.createElement("tt"),"");
				//ins.style.fontSize="10pt";
				//ins.innerText=JSON.stringify(resp);

				var addr=resp.pollingLocations[0].address;
				document.getElementById("ppName").innerText=addr.locationName;
				document.getElementById("ppLine1").innerText=addr.line1;
				document.getElementById("ppLine2").innerText=addr.city + ", " + addr.zip;


			}
			function handleAuthResult(authResult) {
				console.log( "handleAuthResult begins" );
				/*
				var ElectionID=4047;
				var Address=document.getElementById("inputaddress").innerText;
				var Request=gapi.client.request({
					"path":"/civicinfo/v1/voterinfo/" + ElectionID + "/lookup",
					"method":"POST",
					"body":{"address": Address }
				});
				//Request.execute(callback);
				Request.execute();
				*/
				document.getElementById("PollingPlace1").innerText=JSON.stringify(authResult);
			    console.log( "authResult: " + JSON.stringify(authResult) );
				console.log( "handleAuthResult ends" );
			}
			function enterkey() {
				var key;
				if (window.event) key=event.keyCode;
				else if (event.which) key=event.which;
				//console.log( String.fromCharCode(key));
				if (key==0x0d) document.getElementById("btnSearch").click();
			}
			function q1Yes() {
				document.location="http://teachoutwu.amicushq.com/landing/1";
			}
			function q1NotYet() {
				document.getElementById("q1").style.display="none";
				document.getElementById("ads").style.display="block";
				document.getElementById("q2").style.display="block";
				document.getElementById("inputaddress").focus();
			}
			function SetToolAlignment() {
				console.log("SetToolAlignment");
				if (document.getElementsByTagName("iframe").length>0) {
					document.getElementsByTagName("iframe")[0].style.position="relative";
					console.log("alignment set.")
				}
				else {
					console.log( getElementsByTagName("iframe").length );
					window.setTimeout(SetToolAlignment,1000);
				}
			}
		</script>
		<!--
		<script type="text/javascript" src="https://apis.google.com/js/client.js?onload=handleClientLoad"></script>
		-->
		<script type="text/javascript" src="https://apis.google.com/js/client.js"></script>
	</head>

<body>
  <div class="container">
    <a href="#" class="button button-green">Download</a>
    <a href="#" class="button button-red">Download</a>
    <a href="#" class="button button-blue">Download</a>
    <a href="#" class="button button-orange">Download</a><br><a href="#" class="button button-pink">Download</a>
    <a href="#" class="button button-purple">Download</a>
    <a href="#" class="button button-darkblue">Download</a>
    <a href="#" class="button button-gray">Download</a>
  </div>

  <div class="about">
    <p class="about-links">
      <a href="http://www.cssflow.com/snippets/download-buttons" target="_parent">View Article</a>
      <a href="http://www.cssflow.com/snippets/download-buttons.zip" target="_parent">Download</a>
    </p>
    <p class="about-author">
      &copy; 2013 <a href="http://thibaut.me" target="_blank">Thibaut Courouble</a> -
      <a href="http://www.cssflow.com/mit-license" target="_blank">MIT License</a><br>
      Original PSD by <a href="http://365psd.com/day/3-357/" target="_blank">Julius Csurgo</a>
    </p>
  </div>
</body>
</html>
